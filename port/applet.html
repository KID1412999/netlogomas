<html>
<head>
<title>port</title>
<style type="text/css">
<!--
/*
    This style sheet is borrowed from the NetLogo User Manual.  However, some of the units were
    changed from em to px because Java's StyleSheet support is limited for relative units such as
    em and % (this will supposively improve with newer versions of the VM) - jrn 7/21/05
    BE VERY VERY CAREFUL when you alter this style sheet -- it's possible to put in
    innocent-looking things that work on some VM's but cause Java exceptions on other for example
    we were using "font-size: 125%" but it caused Java exceptions on Java 1.5 on Windows - ST
    8/25/05
*/
:link { color: rgb(110,0,110); }
:visited { color: rgb(110,0,110); }
body {
    margin-left: 5px;
    font-family: arial, sans-serif;
    background: white;
    font-size: 12pt
}
h1 {
    color: white;
    background: rgb(45,0,45);
    font-size: 18pt;
    margin-bottom: 4px;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h2 {
    margin-top: 15px;
    margin-left: 6px;
    margin-bottom: 4px;
    background: rgb(166,172,255);
    font-size: 15pt;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h3 {
    margin-top: 15px;
    margin-left: 13px;
    margin-bottom: 4px;
    background: rgb(175,175,175);
    font-size: 12pt;
    padding: 0.2em;
    padding-left: 6px;
    padding-right: 6px;
    padding-top: 6px;
    padding-bottom: 6px;
}
h4 {
    margin-top: 15px;
    margin-bottom: 5px;
    margin-left: 15px;
    font-size: 12pt;
}
h5 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
h6 {
    margin-top: 15px;
    margin-left: 15px;
    font-size: 12pt;
}
p {
    margin-left: 15px;
    margin-bottom: 3px;
}
pre {
    margin-left: 13px;
    background: rgb(225,225,225);
    font-family: monospace;
    font-size: 12pt;
    padding-left: 10px;
    padding-right: 3px;
    padding-top: 7px;
    padding-bottom: 7px;
    margin-top:9px;
    margin-bottom:0px;
}
code {
    font-family: monospace;
    font-size: 12pt;
}
blockquote {
    border: solid;
    border-style: solid;
    border-width: thin;
    border-color: black;
    background: rgb(250,250,220);
    padding-top: 0px;
    padding-bottom: 7px;
    margin-top: 7px;
    margin-bottom:1px;
}
ol {
   margin-bottom:1px;
}
ul {
   margin-bottom:1px;
}

-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 5.0beta2.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p><hr>

<p><font size="-1">In order for this to work, this file, your model file
(port.nlogo), and the file NetLogoLite.jar
must all be in the same directory.  (You can copy NetLogoLite.jar
from the directory where you installed NetLogo.)</font></p>

<p><font size="-1">On some systems, you can test the applet locally on your computer
before uploading it to a web server.  It doesn't work on all systems,
though, so if it doesn't work from your hard drive, please try
uploading it to a web server.</font></p>

<p><font size="-1">You don't need to include everything in this file in your page.
If you want, you can just take the HTML code beginning with
&lt;applet&gt; and ending with &lt;/applet&gt;, and paste it into any HTML
file you want.  It's even OK to put multiple &lt;applet&gt; tags
on a single page.</font></p>

<p><font size="-1">If NetLogoLite.jar and your model are in different
directories, you must modify the archive= and value= lines
in the HTML code to point to their actual locations.
(For example, if you have multiple applets in different
directories on the same web server, you may want to put 
a single copy of NetLogoLite.jar in one central place and
change the archive= lines of all the HTML files to point
to that one central copy.  This will save disk space for
you and download time for your users.)</font></p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="1574" height="480">
  <param name="DefaultModel"
         value="port.nlogo">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="port.nlogo">port.nlogo</a></p>
<h1>Container Port Simulation</h1><h2>WHAT IS IT?</h2><p><img src="port.png"  alt="screenshot"/></p><p>A simulation of a container port. We model the movement of the cranes using various utility functions to determine what is the best behavior for the crane operators. The trucks have random arrival times. More details can be found at </p>
<ol>
  
  <li>
    <p>Nathan Huynh and Jose M. Vidal. <a href="http://jmvidal.cse.sc.edu/papers/huynh10a.pdf">An Agent-Based Approach to Modeling Yard Cranes at Seaport Container Terminals</a>. In <em>Proceedings of the Symposium on Theory of Modeling and Simulation</em>, 2010. </p>
  </li>
  <li>
    <p>Jose M Vidal and Nathan Huynh. <a href="http://jmvidal.cse.sc.edu/papers/vidal10a.pdf">Building Agent-Based Models of Seaport Container Terminals</a>. In <em>Proceedings of 6th Workshop on Agents in Traffic and Transportation</em>, 2010. </p>
  </li>
</ol><h2>CREDITS</h2><p>Jose M Vidal and Nathan Huynh</p><h2>CHANGES</h2><p>20110303</p><p>Last change.</p>

<h1>PROCEDURES</h1>
<pre><font color="#007f69">breed</font><font color="#000000"> [containers container]
</font><font color="#007f69">containers-own</font><font color="#000000"> [
  z-cor </font><font color="#5a5a5a">;0..3, the z-coordinate of this container</font><font color="#000000">
  my-group </font><font color="#5a5a5a">;my position</font><font color="#000000">
  my-stack </font><font color="#5a5a5a">;my position</font><font color="#000000">
  my-row   </font><font color="#5a5a5a">;my position</font><font color="#000000">
  my-truck </font><font color="#5a5a5a">;the truck that wants me, or is carrying me</font><font color="#000000">
]
</font><font color="#660096">breed</font><font color="#000000"> [cranes crane]
</font><font color="#007f69">cranes-own</font><font color="#000000"> [
  goal</font><font color="#5a5a5a">; [#ticks-to-wait &quot;goal-position&quot; group stack] of the goal position for the crane, or [&quot;deliver-containter&quot; container-who], or []</font><font color="#000000">
]
</font><font color="#660096">breed</font><font color="#000000"> [trucks truck]
</font><font color="#007f69">trucks-own</font><font color="#000000"> [
  cargo </font><font color="#5a5a5a">;the container that I want to get</font><font color="#000000">
  my-group
  my-stack
  my-start-time </font><font color="#5a5a5a">;creation time of each truck</font><font color="#000000">
  waiting </font><font color="#5a5a5a">; true if I am waiting outside the port, waiting to get in because there is another truck in my stack</font><font color="#000000">
]

</font><font color="#5a5a5a">;ticks: each tick is one second</font><font color="#000000">
</font><font color="#007f69">globals</font><font color="#000000"> [
  crane-road-xcors </font><font color="#5a5a5a">; list of the x-coordinates where the crane road travels N&lt;-&gt;S</font><font color="#000000">
  crane-road-ycors </font><font color="#5a5a5a">; list of the y-coordinates where the crane road travels E&lt;-&gt;W</font><font color="#000000">
  num-trucks-serviced </font><font color="#5a5a5a">; total number of trucks served</font><font color="#000000">
  total-wait-time </font><font color="#5a5a5a">; total wait time of all trucks that have been served</font><font color="#000000">
  decommitment-penalty </font><font color="#5a5a5a">;</font><font color="#000000">
  ticks-to-rehandle
  ticks-to-deliver
  ticks-to-move 
  
] 

</font><font color="#007f69">to</font><font color="#000000"> setup
  </font><font color="#5a5a5a">;; (for this model to work with NetLogo's new plotting features,</font><font color="#000000">
  </font><font color="#5a5a5a">;; __clear-all-and-reset-ticks should be replaced with clear-all at</font><font color="#000000">
  </font><font color="#5a5a5a">;; the beginning of your setup procedure and reset-ticks at the end</font><font color="#000000">
  </font><font color="#5a5a5a">;; of the procedure.)</font><font color="#000000">
  </font><font color="#0000aa">__clear-all-and-reset-ticks</font><font color="#000000">
  </font><font color="#5a5a5a">;each tick is one second, below </font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> ticks-to-rehandle </font><font color="#963700">40</font><font color="#000000"> </font><font color="#5a5a5a">; number of ticks it takes for crane to move container from one place to another in the same stack.</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> ticks-to-deliver </font><font color="#963700">50</font><font color="#000000"> </font><font color="#5a5a5a">;number of ticks it takes for crane to move container from stack to truck</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> ticks-to-move </font><font color="#963700">6</font><font color="#000000"> </font><font color="#5a5a5a">;number of ticks it takes for the crane to move to an adjacent container</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> decommitment-penalty </font><font color="#963700">1000</font><font color="#000000">
  </font><font color="#0000aa">set</font><font color="#000000"> crane-road-xcors (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">41</font><font color="#000000"> </font><font color="#963700">82</font><font color="#000000">)
  </font><font color="#0000aa">set</font><font color="#000000"> crane-road-ycors (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> </font><font color="#963700">15</font><font color="#000000">)
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">]
  
  </font><font color="#5a5a5a">;the road in which the crane travels is grey</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">member?</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000"> crane-road-ycors][
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [(</font><font color="#660096">pycor</font><font color="#000000"> </font><font color="#660096">&gt;=</font><font color="#000000">  </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> crane-road-ycors </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000"> </font><font color="#660096">&lt;=</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> crane-road-ycors) </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">member?</font><font color="#000000"> </font><font color="#660096">pxcor</font><font color="#000000"> crane-road-xcors)][
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">grey</font><font color="#000000">]
  
  create-containers </font><font color="#963700">1000</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> z-cor </font><font color="#963700">0</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;square&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">.6</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> my-truck </font><font color="#963700">nobody</font><font color="#000000">
    find-random-empty-position
  ]
  create-cranes </font><font color="#963700">1</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;arrow&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> goal []
    set-my-position position-in-yard </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">
  ]
  create-cranes </font><font color="#963700">1</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;arrow&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">orange</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> goal []
    set-my-position position-in-yard </font><font color="#963700">4</font><font color="#000000"> </font><font color="#963700">41</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> go
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">14400</font><font color="#000000"> [ </font><font color="#0000aa">stop</font><font color="#000000"> ]  </font><font color="#5a5a5a">; stop after 4800 ticks which is equal to 4 hours</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> trucks-per-tick truck-arrival </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">60</font><font color="#000000"> </font><font color="#5a5a5a">;truck-arrival is in trucks/minute, convert to trucks/second since each tick is 1 second</font><font color="#000000">
  create-trucks (</font><font color="#660096">random-poisson</font><font color="#000000"> trucks-per-tick) [ </font><font color="#5a5a5a">;Poisson arrival rate</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;truck&quot;</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> waiting </font><font color="#963700">false</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> my-start-time </font><font color="#660096">ticks</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> cargo </font><font color="#660096">one-of</font><font color="#000000"> containers </font><font color="#660096">with</font><font color="#000000"> [my-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
    </font><font color="#0000aa">if</font><font color="#000000"> (cargo </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [</font><font color="#0000aa">die</font><font color="#000000"> </font><font color="#0000aa">stop</font><font color="#000000">] </font><font color="#5a5a5a">;all stacks are full!!</font><font color="#000000">
    </font><font color="#0000aa">ask</font><font color="#000000"> cargo [
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"> </font><font color="#963700">orange</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">)
    ]
    goto-container
    </font><font color="#0000aa">set</font><font color="#000000"> my-group [my-group] </font><font color="#660096">of</font><font color="#000000"> cargo
    </font><font color="#0000aa">set</font><font color="#000000"> my-stack [my-stack] </font><font color="#660096">of</font><font color="#000000"> cargo
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label-color</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> show-start-time?
    [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label</font><font color="#000000"> my-start-time ] </font><font color="#5a5a5a">;; the label is set to be the value of the my-start-time</font><font color="#000000">
    [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">label</font><font color="#000000"> </font><font color="#963700">&quot;&quot;</font><font color="#000000"> ]     </font><font color="#5a5a5a">;; the label is set to an empty text value    </font><font color="#000000">
    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> trucks-here) [ </font><font color="#5a5a5a">;someone is already here, go to the waiting spot</font><font color="#000000">
      </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">16</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> waiting </font><font color="#963700">true</font><font color="#000000">
    ] 
    </font><font color="#0000aa">ask</font><font color="#000000"> cargo [
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> my-truck </font><font color="#660096">myself</font><font color="#000000">]
  ]
  </font><font color="#0000aa">ask</font><font color="#000000"> cranes [go-crane]
  </font><font color="#0000aa">tick</font><font color="#000000">
  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Number of Trucks&quot;</font><font color="#000000">
  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> trucks
  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Number of Trucks Serviced&quot;</font><font color="#000000">
  </font><font color="#0000aa">plot</font><font color="#000000"> num-trucks-serviced
  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Average Wait Time&quot;</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> num-trucks-serviced </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [</font><font color="#0000aa">plot</font><font color="#000000"> total-wait-time </font><font color="#660096">/</font><font color="#000000"> num-trucks-serviced]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> set-my-position [position-vector]
  </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> position-vector) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> position-vector)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Translates group#, stack#, row# pairs into x,y coordinates in the model</font><font color="#000000">
</font><font color="#5a5a5a">;Returns the position-vector [x y] where x,y are the patch coordinates</font><font color="#000000">
</font><font color="#5a5a5a">; of group,stack,row</font><font color="#000000">
</font><font color="#5a5a5a">; group: 0..3 is the group number</font><font color="#000000">
</font><font color="#5a5a5a">; stack: 0..39 is the stack number</font><font color="#000000">
</font><font color="#5a5a5a">; row: 0..5 is the row number</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> position-in-yard [group stack row]
  </font><font color="#0000aa">let</font><font color="#000000"> y-pos </font><font color="#660096">int</font><font color="#000000"> (group </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
  </font><font color="#0000aa">ifelse</font><font color="#000000"> (y-pos </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [
    </font><font color="#0000aa">set</font><font color="#000000"> y-pos </font><font color="#963700">14</font><font color="#000000">
   ][
    </font><font color="#0000aa">set</font><font color="#000000"> y-pos </font><font color="#963700">6</font><font color="#000000">
  ]
  </font><font color="#0000aa">set</font><font color="#000000"> y-pos (y-pos </font><font color="#660096">-</font><font color="#000000"> row)
  </font><font color="#0000aa">let</font><font color="#000000"> x-pos ((group </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">41</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">+</font><font color="#000000"> stack
  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">list</font><font color="#000000"> x-pos y-pos
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;========================================</font><font color="#000000">
</font><font color="#5a5a5a">;crane functions</font><font color="#000000">

</font><font color="#5a5a5a">;Gets called at every tick, makes the crane do what it needs to do.</font><font color="#000000">
</font><font color="#5a5a5a">;An opportunistic crane will re-evaluate its goal-position goal at every tick</font><font color="#000000">
</font><font color="#5a5a5a">;A non opportunistic crane picks a goal-position and sticks to it until it delivers the container to that truck.</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> go-crane
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">empty?</font><font color="#000000"> goal </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> goal </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)[ </font><font color="#5a5a5a">;not time yet, countdown</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> goal </font><font color="#660096">replace-item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> goal (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> goal </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)
    </font><font color="#0000aa">stop</font><font color="#000000">  ]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">empty?</font><font color="#000000"> goal </font><font color="#660096">or</font><font color="#000000"> (opportunistic? </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;goal-position&quot;</font><font color="#000000">)) [</font><font color="#5a5a5a">;no goal position or opportunistic, set new goal</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting])[
      </font><font color="#0000aa">let</font><font color="#000000"> goalp []
      </font><font color="#0000aa">if</font><font color="#000000"> (crane-pick-goal-function </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;random&quot;</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position]
      </font><font color="#0000aa">if</font><font color="#000000"> (crane-pick-goal-function </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;longest&quot;</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position-longest]
      </font><font color="#0000aa">if</font><font color="#000000"> (crane-pick-goal-function </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;closest&quot;</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position-closest]
      </font><font color="#0000aa">if</font><font color="#000000"> (crane-pick-goal-function </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;closest-longest&quot;</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position-closest-longest]
      </font><font color="#0000aa">if</font><font color="#000000"> (crane-pick-goal-function </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;eq-1&quot;</font><font color="#000000">) [
        </font><font color="#0000aa">ifelse</font><font color="#000000"> (semi-committed? </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">empty?</font><font color="#000000"> goal) [
          </font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position-eq-1-commited (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> goal </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> goal)
        ][ 
          </font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position-eq-1
        ]
        ]
      </font><font color="#0000aa">if</font><font color="#000000"> (crane-pick-goal-function </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;eq-2&quot;</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> goalp pick-goal-position-eq-2]
      </font><font color="#0000aa">ifelse</font><font color="#000000"> (goalp </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [ </font><font color="#5a5a5a">; if a valid group and stack values are returned</font><font color="#000000">
        </font><font color="#0000aa">set</font><font color="#000000"> goal (</font><font color="#660096">sentence</font><font color="#000000"> ticks-to-move </font><font color="#963700">&quot;goal-position&quot;</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> goalp </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goalp)
      ][
        </font><font color="#0000aa">set</font><font color="#000000"> goal [] </font><font color="#5a5a5a">; reset goal</font><font color="#000000">
        </font><font color="#0000aa">stop</font><font color="#000000"> </font><font color="#5a5a5a">; crane stay put until next tick</font><font color="#000000">
      ]      
    ][
      </font><font color="#0000aa">stop</font><font color="#000000">
    ]
  ]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;goal-position&quot;</font><font color="#000000">) [ </font><font color="#5a5a5a">;move towards goal-position</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> goal-position-xy position-in-yard (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> goal) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> goal) </font><font color="#963700">-1</font><font color="#000000">
    goto-position (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> goal) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> goal)
    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> trucks-on (</font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> goal-position-xy) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal-position-xy </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">))) [ </font><font color="#5a5a5a">;if there is no truck at the goal then reset goal</font><font color="#000000">
        </font><font color="#0000aa">set</font><font color="#000000"> goal []
        </font><font color="#0000aa">stop</font><font color="#000000">
    ]
    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> goal-position-xy </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal-position-xy </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">) [</font><font color="#5a5a5a">;we are at the goal, next time deliver container</font><font color="#000000">
      </font><font color="#0000aa">let</font><font color="#000000"> the-truck trucks-in-this-stack
      </font><font color="#0000aa">set</font><font color="#000000"> goal (</font><font color="#660096">list</font><font color="#000000"> ticks-to-deliver </font><font color="#963700">&quot;deliver-container&quot;</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [cargo] </font><font color="#660096">of</font><font color="#000000"> the-truck))
    ] 
    </font><font color="#0000aa">stop</font><font color="#000000">
  ]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;deliver-container&quot;</font><font color="#000000">) [
    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> goal </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [ </font><font color="#5a5a5a">;if another cranes just delivered this container</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> goal []
      </font><font color="#0000aa">stop</font><font color="#000000">
    ]
    deliver-container (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> goal)
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;moves the-container to the truck it belongs to, if the-container has no other containers on top of itself</font><font color="#000000">
</font><font color="#5a5a5a">;if the-container has another container on top then the top container is moved to the lowest pile in the stack</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> deliver-container [the-container]
  </font><font color="#0000aa">let</font><font color="#000000"> pile-height </font><font color="#660096">max</font><font color="#000000"> ([z-cor] </font><font color="#660096">of</font><font color="#000000"> containers-on the-container)
  </font><font color="#0000aa">ifelse</font><font color="#000000"> ([z-cor] </font><font color="#660096">of</font><font color="#000000"> the-container </font><font color="#660096">=</font><font color="#000000"> pile-height) [ </font><font color="#5a5a5a">;the-container is at the top</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> the-truck trucks-in-this-stack
    </font><font color="#0000aa">let</font><font color="#000000"> the-containers-in-stack []
    </font><font color="#0000aa">ask</font><font color="#000000"> the-truck [
      </font><font color="#0000aa">set</font><font color="#000000"> the-containers-in-stack containers-in-stack 
      </font><font color="#0000aa">set</font><font color="#000000"> total-wait-time total-wait-time </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> my-start-time)
      </font><font color="#0000aa">die</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> num-trucks-serviced num-trucks-serviced </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> goal []
    </font><font color="#0000aa">ask</font><font color="#000000"> the-container [</font><font color="#0000aa">die</font><font color="#000000">]
    </font><font color="#0000aa">let</font><font color="#000000"> containers-with-truck the-containers-in-stack </font><font color="#660096">with</font><font color="#000000"> [my-truck </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
    </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> containers-with-truck) [ 
      </font><font color="#0000aa">ask</font><font color="#000000"> (</font><font color="#660096">one-of</font><font color="#000000"> [my-truck] </font><font color="#660096">of</font><font color="#000000"> containers-with-truck) [ </font><font color="#5a5a5a">;if any trucks are waiting for this spot, pick one and mobe him here</font><font color="#000000">
        goto-container
        </font><font color="#0000aa">set</font><font color="#000000"> waiting </font><font color="#963700">false</font><font color="#000000">
      ]
    ]
    </font><font color="#0000aa">stop</font><font color="#000000">
  ][ </font><font color="#5a5a5a">;the-container is not at the top, move top container to smallest column in this stack</font><font color="#000000">
    </font><font color="#0000aa">let</font><font color="#000000"> the-container-column ([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-container </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">)
    </font><font color="#0000aa">let</font><font color="#000000"> other-columns </font><font color="#660096">remove</font><font color="#000000"> the-container-column (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#963700">-2</font><font color="#000000"> </font><font color="#963700">-3</font><font color="#000000"> </font><font color="#963700">-4</font><font color="#000000"> </font><font color="#963700">-5</font><font color="#000000"> </font><font color="#963700">-6</font><font color="#000000">)
    </font><font color="#0000aa">let</font><font color="#000000"> min-column-height </font><font color="#660096">min</font><font color="#000000"> </font><font color="#660096">map</font><font color="#000000"> [</font><font color="#660096">count</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> ?] other-columns
    </font><font color="#0000aa">let</font><font color="#000000"> min-columns </font><font color="#660096">filter</font><font color="#000000"> [</font><font color="#660096">count</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> ? </font><font color="#660096">=</font><font color="#000000"> min-column-height] other-columns
    </font><font color="#0000aa">let</font><font color="#000000"> destination </font><font color="#660096">one-of</font><font color="#000000"> min-columns     
    </font><font color="#5a5a5a">;move the top container to destination</font><font color="#000000">
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">max-one-of</font><font color="#000000"> (containers-at </font><font color="#963700">0</font><font color="#000000"> the-container-column) [z-cor] [
      move-to-position ([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> destination)
    ]
    </font><font color="#5a5a5a">;to make the moving of each container take 3 steps uncomment the following line</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> goal (</font><font color="#660096">list</font><font color="#000000"> ticks-to-rehandle </font><font color="#963700">&quot;deliver-container&quot;</font><font color="#000000"> the-container)
  ]
</font><font color="#007f69">end</font><font color="#000000">
    
</font><font color="#007f69">to-report</font><font color="#000000"> trucks-in-this-stack
  </font><font color="#0000aa">report</font><font color="#000000"> trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> ([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">)]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Decide which truck to service</font><font color="#000000">
</font><font color="#5a5a5a">;returns the [group stack] of a random truck</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">one-of</font><font color="#000000"> trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;returns the [group stack] of the truck that has waited the longest</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position-longest
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">min-one-of</font><font color="#000000"> (trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting]) [my-start-time]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;returns the [group stack] of the truck that is closest (in terms of time, not distance) to crane</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position-closest
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">min-one-of</font><font color="#000000"> (trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting]) [distance-to-crane </font><font color="#660096">myself</font><font color="#000000">]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;returns the [group stack] of the truck that are among the closest to crane, but has longest waiting time</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position-closest-longest
  </font><font color="#0000aa">let</font><font color="#000000"> range </font><font color="#963700">40</font><font color="#000000"> </font><font color="#5a5a5a">; range of search area.  experimental variable.  will it have an affect on the truck wait time?</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> trucks-in-range trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting </font><font color="#660096">and</font><font color="#000000"> distance-to-crane </font><font color="#660096">myself</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> range]
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">min-one-of</font><font color="#000000"> trucks-in-range [my-start-time]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Pick the truck that maximizes utility-eq-1  </font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position-eq-1 
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">max-one-of</font><font color="#000000"> (trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting]) [utility-eq-1 </font><font color="#660096">myself</font><font color="#000000">]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Pick the truck that maximizes utility-eq-1  </font><font color="#000000">
</font><font color="#5a5a5a">; but only if its utility is higher than the one at current-goal by at least decommitment-penalty</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position-eq-1-commited [current-goal] 
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">max-one-of</font><font color="#000000"> (trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting]) [utility-eq-1 </font><font color="#660096">myself</font><font color="#000000">]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> current-goal]
  </font><font color="#0000aa">let</font><font color="#000000"> utility-of-chosen-truck [utility-eq-1 </font><font color="#660096">myself</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
  
  </font><font color="#0000aa">let</font><font color="#000000"> current-truck </font><font color="#660096">one-of</font><font color="#000000"> trucks </font><font color="#660096">with</font><font color="#000000"> [my-group </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> current-goal </font><font color="#660096">and</font><font color="#000000"> my-stack </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> current-goal]
  </font><font color="#0000aa">if</font><font color="#000000"> (current-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck]
  </font><font color="#0000aa">let</font><font color="#000000"> utility-of-current-truck [utility-eq-1 </font><font color="#660096">myself</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> current-truck
  
  </font><font color="#0000aa">ask</font><font color="#000000"> current-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000">]
  </font><font color="#0000aa">ifelse</font><font color="#000000"> (utility-of-chosen-truck </font><font color="#660096">&gt;</font><font color="#000000"> utility-of-current-truck </font><font color="#660096">+</font><font color="#000000"> decommitment-penalty) [ </font><font color="#5a5a5a">;is the new goal that much better than the current?</font><font color="#000000">
    </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
    </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
  ][
    </font><font color="#0000aa">ask</font><font color="#000000"> current-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
    </font><font color="#0000aa">report</font><font color="#000000"> current-goal
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Pick the truck that maximizes utility-eq-2  </font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> pick-goal-position-eq-2 
  </font><font color="#0000aa">let</font><font color="#000000"> chosen-truck </font><font color="#660096">max-one-of</font><font color="#000000"> (trucks </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">not</font><font color="#000000"> waiting]) [utility-eq-2 </font><font color="#660096">myself</font><font color="#000000">]
  </font><font color="#0000aa">if</font><font color="#000000"> (chosen-truck </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">) [
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">nobody</font><font color="#000000">]
  </font><font color="#0000aa">ask</font><font color="#000000"> chosen-truck [</font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">yellow</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> [group-stack] </font><font color="#660096">of</font><font color="#000000"> chosen-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Returns a list of the patch coords the crane must follow to go from xstart,ystart to xend,yend</font><font color="#000000">
</font><font color="#5a5a5a">;Assumes that either xstart=xend or ystart=yend</font><font color="#000000">
</font><font color="#5a5a5a">;The return path omits xstart,ystart but includes xend,yend</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> make-path [xstart ystart xend yend]
  </font><font color="#0000aa">if</font><font color="#000000"> (xstart </font><font color="#660096">=</font><font color="#000000"> xend) [
    </font><font color="#0000aa">let</font><font color="#000000"> increment </font><font color="#660096">ifelse-value</font><font color="#000000"> (ystart </font><font color="#660096">&gt;</font><font color="#000000"> yend) [</font><font color="#963700">1</font><font color="#000000">][</font><font color="#963700">-1</font><font color="#000000">]
    </font><font color="#0000aa">let</font><font color="#000000"> result []
    </font><font color="#0000aa">let</font><font color="#000000"> p yend
    </font><font color="#0000aa">repeat</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (ystart </font><font color="#660096">-</font><font color="#000000"> yend) [
      </font><font color="#0000aa">set</font><font color="#000000"> result </font><font color="#660096">fput</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> xstart p) result
      </font><font color="#0000aa">set</font><font color="#000000"> p p </font><font color="#660096">+</font><font color="#000000"> increment
    ]
    </font><font color="#0000aa">report</font><font color="#000000"> result
  ]
  </font><font color="#0000aa">if</font><font color="#000000"> (ystart </font><font color="#660096">=</font><font color="#000000"> yend) [
    </font><font color="#0000aa">let</font><font color="#000000"> increment </font><font color="#660096">ifelse-value</font><font color="#000000"> (xstart </font><font color="#660096">&gt;</font><font color="#000000"> xend) [</font><font color="#963700">1</font><font color="#000000">][</font><font color="#963700">-1</font><font color="#000000">]
    </font><font color="#0000aa">let</font><font color="#000000"> result []
    </font><font color="#0000aa">let</font><font color="#000000"> p xend
    </font><font color="#0000aa">repeat</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (xstart </font><font color="#660096">-</font><font color="#000000"> xend) [
      </font><font color="#0000aa">set</font><font color="#000000"> result </font><font color="#660096">fput</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> p ystart) result
      </font><font color="#0000aa">set</font><font color="#000000"> p p </font><font color="#660096">+</font><font color="#000000"> increment
    ]
    </font><font color="#0000aa">report</font><font color="#000000"> result
  ]
  </font><font color="#5a5a5a">;both x &amp; y coords are different</font><font color="#000000">
  </font><font color="#0000aa">show</font><font color="#000000"> (</font><font color="#660096">word</font><font color="#000000"> </font><font color="#963700">&quot;ERROR: make-path:&quot;</font><font color="#000000"> xstart </font><font color="#963700">&quot;,&quot;</font><font color="#000000"> ystart </font><font color="#963700">&quot;  &quot;</font><font color="#000000"> xend </font><font color="#963700">&quot;,&quot;</font><font color="#000000"> yend)
  </font><font color="#0000aa">report</font><font color="#000000"> []
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;reports the shortest path from our current xcor,ycor to goal-x,goal-y</font><font color="#000000">
</font><font color="#5a5a5a">;returns list [[x1 y1][x2 y2]....] where xi yi are the positions (patch coordinates) the crane must follow, in order.</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> path-to-xy [goal-x goal-y]
   </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> goal-y) [</font><font color="#5a5a5a">;I am in the same W&lt;-&gt;E as the goal</font><font color="#000000">
    </font><font color="#0000aa">report</font><font color="#000000"> make-path </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> goal-x goal-y
  ]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">member?</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> crane-road-xcors) [ </font><font color="#5a5a5a">; I am traveling N&lt;-&gt;S</font><font color="#000000">
    </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">sentence</font><font color="#000000"> (make-path </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> goal-y) (make-path </font><font color="#660096">xcor</font><font color="#000000"> goal-y goal-x goal-y))
  ]
  </font><font color="#5a5a5a">;I am not in the same ycor as the goal, find shortest route</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> all-distances </font><font color="#660096">map</font><font color="#000000"> [(</font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ?)) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (goal-x </font><font color="#660096">-</font><font color="#000000"> ?)] crane-road-xcors
  </font><font color="#0000aa">let</font><font color="#000000"> best-crossroad </font><font color="#660096">item</font><font color="#000000"> (</font><font color="#660096">position</font><font color="#000000"> (</font><font color="#660096">min</font><font color="#000000"> all-distances) all-distances) crane-road-xcors
  </font><font color="#0000aa">let</font><font color="#000000"> other-ycor </font><font color="#660096">first</font><font color="#000000"> </font><font color="#660096">filter</font><font color="#000000"> [? </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">] crane-road-ycors
  </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">sentence</font><font color="#000000"> (make-path </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> best-crossroad </font><font color="#660096">ycor</font><font color="#000000">) (make-path best-crossroad </font><font color="#660096">ycor</font><font color="#000000"> best-crossroad other-ycor) (make-path best-crossroad other-ycor goal-x goal-y))
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> path-to-group-stack [group stack]
  </font><font color="#0000aa">let</font><font color="#000000"> goal-pos position-in-yard group stack </font><font color="#963700">-1</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> goal-x </font><font color="#660096">first</font><font color="#000000"> goal-pos
  </font><font color="#0000aa">let</font><font color="#000000"> goal-y </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal-pos
  </font><font color="#0000aa">report</font><font color="#000000"> path-to-xy goal-x goal-y
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> path-to-truck [the-truck]
  </font><font color="#0000aa">report</font><font color="#000000"> path-to-xy [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-truck [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-truck
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;returns the length of the minimum path to goal-x,goal-y. This function is similar to path-to-xy but does not create the path, so its faster.</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> distance-to-xy [goal-x goal-y]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> goal-y) [</font><font color="#5a5a5a">;I am in the same W&lt;-&gt;E as the goal</font><font color="#000000">
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> goal-x)
  ]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">member?</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> crane-road-xcors) [ </font><font color="#5a5a5a">; I am traveling N&lt;-&gt;S</font><font color="#000000">
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> goal-y) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> goal-x)
  ]
  </font><font color="#5a5a5a">;I am not in the same ycor as the goal, find shortest route</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> all-distances </font><font color="#660096">map</font><font color="#000000"> [(</font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ?)) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (goal-x </font><font color="#660096">-</font><font color="#000000"> ?)] crane-road-xcors
  </font><font color="#0000aa">let</font><font color="#000000"> best-crossroad </font><font color="#660096">item</font><font color="#000000"> (</font><font color="#660096">position</font><font color="#000000"> (</font><font color="#660096">min</font><font color="#000000"> all-distances) all-distances) crane-road-xcors
  </font><font color="#0000aa">let</font><font color="#000000"> other-ycor </font><font color="#660096">first</font><font color="#000000"> </font><font color="#660096">filter</font><font color="#000000"> [? </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">] crane-road-ycors
  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> best-crossroad) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> other-ycor) </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">abs</font><font color="#000000"> (best-crossroad </font><font color="#660096">-</font><font color="#000000"> goal-x)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> distance-to-group-stack [group stack]
  </font><font color="#0000aa">let</font><font color="#000000"> goal-pos position-in-yard group stack </font><font color="#963700">-1</font><font color="#000000">
  </font><font color="#0000aa">report</font><font color="#000000"> distance-to-xy (</font><font color="#660096">first</font><font color="#000000"> goal-pos) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> goal-pos)
</font><font color="#007f69">end</font><font color="#000000"> 

</font><font color="#007f69">to-report</font><font color="#000000"> distance-to-truck [the-truck]
  </font><font color="#0000aa">report</font><font color="#000000"> distance-to-xy [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-truck [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-truck
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;Moves at most one step towards group,stack using the shortest route.</font><font color="#000000">
</font><font color="#5a5a5a">;But, if there is a crane in the position that I want to go then I say put</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> goto-position [group stack]
  </font><font color="#0000aa">let</font><font color="#000000"> path path-to-group-stack group stack
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">length</font><font color="#000000"> path </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">stop</font><font color="#000000">]
  </font><font color="#0000aa">let</font><font color="#000000"> next </font><font color="#660096">first</font><font color="#000000"> path
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">towardsxy</font><font color="#000000"> (</font><font color="#660096">first</font><font color="#000000"> next) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> next)
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> cranes-on </font><font color="#660096">patch-ahead</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [
    </font><font color="#0000aa">forward</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;reports true if the crane does not need to change its heading to follow path</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> path-in-heading? [path]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">length</font><font color="#000000"> path </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [ </font><font color="#5a5a5a">;if path is empty then we don't need to change heading</font><font color="#000000">
    </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000">
  ]
  </font><font color="#0000aa">let</font><font color="#000000"> pos </font><font color="#660096">first</font><font color="#000000"> path
  </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#660096">towardsxy</font><font color="#000000"> (</font><font color="#660096">first</font><font color="#000000"> pos) (</font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> pos))
</font><font color="#007f69">end</font><font color="#000000">


</font><font color="#5a5a5a">;===========================================================</font><font color="#000000">
</font><font color="#5a5a5a">;container functions</font><font color="#000000">

</font><font color="#5a5a5a">;Tries random positions until it finds one where the container can be placed, the the container is placed there.</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> find-random-empty-position
  </font><font color="#0000aa">loop</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> my-group </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> </font><font color="#5a5a5a">;a group is the set of 40 stacks</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> my-stack </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">40</font><font color="#5a5a5a">; </font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> my-row </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000">
    set-my-position (position-in-yard my-group my-stack my-row)
    </font><font color="#0000aa">let</font><font color="#000000"> others-here </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles-here</font><font color="#000000">
    </font><font color="#0000aa">if</font><font color="#000000"> ((</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> others-here) </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles-here</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">)[ </font><font color="#5a5a5a">;position works, put me here</font><font color="#000000">
      </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> others-here)[
        </font><font color="#0000aa">set</font><font color="#000000"> z-cor </font><font color="#963700">0</font><font color="#000000">
      ][
        </font><font color="#0000aa">set</font><font color="#000000"> z-cor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">max</font><font color="#000000"> [z-cor] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> containers-here
      ]
      </font><font color="#0000aa">stop</font><font color="#000000">
    ]
  ] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;container moves to ypos, resets his z-cor to be at the top of the new column</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> move-to-position [ypos]
  </font><font color="#0000aa">set</font><font color="#000000"> my-row my-row </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> ypos)
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> ypos
  </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> containers-here) [
    </font><font color="#0000aa">set</font><font color="#000000"> z-cor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">max</font><font color="#000000"> [z-cor] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> containers-here
  ][
    </font><font color="#0000aa">set</font><font color="#000000"> z-cor </font><font color="#963700">0</font><font color="#000000">
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;===========================================================</font><font color="#000000">
</font><font color="#5a5a5a">;truck functions</font><font color="#000000">

</font><font color="#5a5a5a">;move the truck to the position where it can pick up cargo (container)</font><font color="#000000">
</font><font color="#007f69">to</font><font color="#000000"> goto-container
  </font><font color="#0000aa">setxy</font><font color="#000000"> ([</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> cargo) ([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> cargo)
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000"> (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> (</font><font color="#963700">6</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> [my-row] </font><font color="#660096">of</font><font color="#000000"> cargo))
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;return an agentset of all the containers in the stack above me</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> containers-in-stack
  </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">turtle-set</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> containers-at </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000">)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> path-to-crane [the-crane]
  </font><font color="#0000aa">report</font><font color="#000000"> [path-to-truck </font><font color="#660096">myself</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-crane
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> distance-to-crane [the-crane]
  </font><font color="#0000aa">report</font><font color="#000000"> [distance-to-truck </font><font color="#660096">myself</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-crane
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> group-stack
  </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> my-group my-stack)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;utility functions: these are truck functions. Each one takes the-crane as argument and returns the utility to the crane for delivering a container to this truck</font><font color="#000000">

</font><font color="#5a5a5a">;utility eq-1: distance-based utility.  The further a truck, the lower its utility.</font><font color="#000000">
</font><font color="#5a5a5a">;utility = 0 - distance(the-crane) - 1000 (if some other crane is on the path to the-crane) - 1000 (if a turn is required)</font><font color="#000000">
</font><font color="#5a5a5a">;  &quot;turn is required&quot; means that the current heading of the crane is NOT the same heading required for the first move in path-to-the-crane</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> utility-eq-1 [the-crane]
  </font><font color="#0000aa">let</font><font color="#000000"> path-to-the-crane path-to-crane the-crane
  </font><font color="#0000aa">let</font><font color="#000000"> other-cranes-coords [(</font><font color="#660096">list</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">)] </font><font color="#660096">of</font><font color="#000000"> (cranes </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">self</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> the-crane])
  </font><font color="#0000aa">let</font><font color="#000000"> other-crane-in-path? </font><font color="#660096">reduce</font><font color="#000000"> [?1 </font><font color="#660096">or</font><font color="#000000"> ?2] (</font><font color="#660096">map</font><font color="#000000"> [</font><font color="#660096">member?</font><font color="#000000"> ? path-to-the-crane] other-cranes-coords)
  </font><font color="#0000aa">let</font><font color="#000000"> turn-required? </font><font color="#963700">false</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> ([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-crane </font><font color="#660096">!=</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">self</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> turn-required? </font><font color="#963700">true</font><font color="#000000">]
  </font><font color="#0000aa">let</font><font color="#000000"> keep-heading? [path-in-heading? path-to-the-crane] </font><font color="#660096">of</font><font color="#000000"> the-crane
  </font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> distance-to-crane the-crane </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ifelse-value</font><font color="#000000"> (other-crane-in-path?)[</font><font color="#963700">10000</font><font color="#000000">][</font><font color="#963700">0</font><font color="#000000">] </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ifelse-value</font><font color="#000000"> (turn-required?)[</font><font color="#963700">1000</font><font color="#000000">][</font><font color="#963700">0</font><font color="#000000">] </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ifelse-value</font><font color="#000000"> (keep-heading?)[</font><font color="#963700">0</font><font color="#000000">][</font><font color="#963700">1000</font><font color="#000000">] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">;utility eq-2: time-based utility.  The longer a truck waits, the higher its utility.</font><font color="#000000">
</font><font color="#5a5a5a">;utility = truck wait time - 1000 (if some other crane is on the path to the-crane) - 1000 (if a turn is required)</font><font color="#000000">
</font><font color="#007f69">to-report</font><font color="#000000"> utility-eq-2 [the-crane]
  </font><font color="#0000aa">let</font><font color="#000000"> path-to-the-crane path-to-crane the-crane
  </font><font color="#0000aa">let</font><font color="#000000"> other-cranes-coords [(</font><font color="#660096">list</font><font color="#000000"> </font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">ycor</font><font color="#000000">)] </font><font color="#660096">of</font><font color="#000000"> (cranes </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">self</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> the-crane])
  </font><font color="#0000aa">let</font><font color="#000000"> other-crane-in-path? </font><font color="#660096">reduce</font><font color="#000000"> [?1 </font><font color="#660096">or</font><font color="#000000"> ?2] (</font><font color="#660096">map</font><font color="#000000"> [</font><font color="#660096">member?</font><font color="#000000"> ? path-to-the-crane] other-cranes-coords)
  </font><font color="#0000aa">let</font><font color="#000000"> turn-required? </font><font color="#963700">false</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> ([</font><font color="#660096">ycor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-crane </font><font color="#660096">!=</font><font color="#000000"> [</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">self</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> turn-required? </font><font color="#963700">true</font><font color="#000000">]
  </font><font color="#0000aa">let</font><font color="#000000"> reverse-heading? </font><font color="#963700">false</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-crane) </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> reverse-heading? </font><font color="#963700">true</font><font color="#000000">]
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">heading</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">270</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> [</font><font color="#660096">xcor</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> the-crane) </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">) [</font><font color="#0000aa">set</font><font color="#000000"> reverse-heading? </font><font color="#963700">true</font><font color="#000000">]
  </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> my-start-time) </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ifelse-value</font><font color="#000000"> (other-crane-in-path?)[</font><font color="#963700">1000</font><font color="#000000">][</font><font color="#963700">0</font><font color="#000000">] </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ifelse-value</font><font color="#000000"> (turn-required?)[</font><font color="#963700">1000</font><font color="#000000">][</font><font color="#963700">0</font><font color="#000000">] </font><font color="#660096">-</font><font color="#000000"> </font><font color="#660096">ifelse-value</font><font color="#000000"> (reverse-heading?)[</font><font color="#963700">1000</font><font color="#000000">][</font><font color="#963700">0</font><font color="#000000">] 
</font><font color="#007f69">end</font>
</pre>

</body>
</html>
